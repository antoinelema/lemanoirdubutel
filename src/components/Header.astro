---
const currentPath = Astro.url.pathname;

const navLinks = [
  { href: '/', label: 'Accueil' },
  { href: '/chambres', label: 'Chambres' },
  { href: '/le-manoir', label: 'Le Manoir' },
  { href: '/loisirs', label: 'Loisirs' },
  { href: '/avis', label: 'Avis' },
  { href: '/contact', label: 'Contact' },
];
---

<header class="fixed top-0 left-0 right-0 z-50 bg-parchment/90 backdrop-blur-sm shadow-sm transition-all duration-300" id="main-header">
  <div class="container mx-auto px-4 md:px-8">
    <nav class="flex items-center justify-between py-3">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group">
        <span class="font-heading text-xl md:text-2xl font-bold text-brown group-hover:text-moss transition-colors">
          Le Manoir du Butel
        </span>
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden lg:flex items-center gap-8">
        {navLinks.map(({ href, label }) => (
          <li>
            <a
              href={href}
              class:list={[
                'font-heading text-sm tracking-wider uppercase transition-colors duration-200',
                currentPath === href || (href !== '/' && currentPath.startsWith(href))
                  ? 'text-gold font-semibold'
                  : 'text-brown-light hover:text-moss',
              ]}
            >
              {label}
            </a>
          </li>
        ))}
        <li>
          <a
            href="/reserver"
            class="btn-gold text-sm !py-2 !px-5"
          >
            Réserver
          </a>
        </li>
      </ul>

      <!-- Mobile Menu Button -->
      <button
        id="mobile-menu-btn"
        class="lg:hidden flex flex-col gap-1.5 p-2"
        aria-label="Ouvrir le menu"
        aria-expanded="false"
      >
        <span class="block w-6 h-0.5 bg-brown transition-all duration-300" id="burger-top"></span>
        <span class="block w-6 h-0.5 bg-brown transition-all duration-300" id="burger-mid"></span>
        <span class="block w-6 h-0.5 bg-brown transition-all duration-300" id="burger-bot"></span>
      </button>
    </nav>
  </div>

</header>

<!-- Mobile Menu (outside header to avoid backdrop-blur containing block) -->
<div
  id="mobile-menu"
  class="lg:hidden fixed inset-0 bg-parchment transform translate-x-full transition-transform duration-300 z-40"
>
  <div class="flex flex-col items-center justify-center h-full gap-8">
    {navLinks.map(({ href, label }) => (
      <a
        href={href}
        class:list={[
          'font-heading text-2xl tracking-wider uppercase transition-colors',
          currentPath === href ? 'text-gold' : 'text-brown hover:text-moss',
        ]}
      >
        {label}
      </a>
    ))}
    <a
      href="/reserver"
      class="btn-gold text-lg mt-4"
    >
      Réserver
    </a>
  </div>
</div>

<script>
  const header = document.getElementById('main-header');
  const menuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  const burgerTop = document.getElementById('burger-top');
  const burgerMid = document.getElementById('burger-mid');
  const burgerBot = document.getElementById('burger-bot');

  let isMenuOpen = false;

  // Scroll effect - slightly more opaque on scroll
  function updateHeader() {
    if (!header) return;
    if (window.scrollY > 50) {
      header.classList.add('bg-parchment/95', 'shadow-md');
      header.classList.remove('bg-parchment/90', 'shadow-sm');
    } else {
      header.classList.remove('bg-parchment/95', 'shadow-md');
      header.classList.add('bg-parchment/90', 'shadow-sm');
    }
  }

  window.addEventListener('scroll', updateHeader);
  updateHeader();

  // Mobile menu toggle
  menuBtn?.addEventListener('click', () => {
    isMenuOpen = !isMenuOpen;
    if (isMenuOpen) {
      mobileMenu?.classList.remove('translate-x-full');
      mobileMenu?.classList.add('translate-x-0');
      burgerTop?.classList.add('rotate-45', 'translate-y-2');
      burgerMid?.classList.add('opacity-0');
      burgerBot?.classList.add('-rotate-45', '-translate-y-2');
      document.body.style.overflow = 'hidden';
    } else {
      mobileMenu?.classList.add('translate-x-full');
      mobileMenu?.classList.remove('translate-x-0');
      burgerTop?.classList.remove('rotate-45', 'translate-y-2');
      burgerMid?.classList.remove('opacity-0');
      burgerBot?.classList.remove('-rotate-45', '-translate-y-2');
      document.body.style.overflow = '';
    }
    menuBtn?.setAttribute('aria-expanded', String(isMenuOpen));
  });
</script>
